version: '1.0'
steps:
  BuildingDockerImage:
    title: Building Docker Image
    type: build
    image_name: eduardomoroni/mtgx
    working_directory: ${{main_clone}}
    dockerfile: Dockerfile
    when:
      branch:
        ignore:
          - gh-pages
  RunningUnitTests:
    title: Running Unit Tests
    image: '${{BuildingDockerImage}}'
    working_directory: IMAGE_WORK_DIR
    when:
      branch:
        ignore:
          - gh-pages
    environment:
      - NODE_ENV=production #Changes behavior of npm install / yarn install
      - CODECLIMATE_REPO_TOKEN=a2e1de6b086b7499a462b1aaec6b39d6369c74ea33232dc9885db3fb1f23527d
    commands:
      - npm run lint-check
      - npm run flow-check
      - npm run update-coverage
    # entry_point:
    #   - /bin/sh
    #   - /codefresh/volume/cf-generated/unit_test_script
    # create_file:
    #   path: /codefresh/volume/cf-generated
    #   name: unit_test_script
    #   content: |-
    #     npm version
    #     npm run lint-check
    #     npm run flow-check
    #     npm test
    #     npm run update-coverage
    # on_success:
    #   metadata:
    #     set:
    #       - '${{BuildingDockerImage.imageId}}':
    #           - CF_QUALITY: true
    # on_fail:
    #   metadata:
    #     set:
    #       - '${{BuildingDockerImage.imageId}}':
    #           - CF_QUALITY: false
